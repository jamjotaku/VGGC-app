<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Vspo! Catalog Admin</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f7f9; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { border-bottom: 2px solid #ff69b4; padding-bottom: 10px; color: #333; }
        
        /* 編集フォーム */
        .edit-form { background: #fff0f6; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none; border: 1px solid #ff69b4; }
        .edit-form input { padding: 8px; margin-right: 10px; border: 1px solid #ddd; border-radius: 4px; }
        
        /* テーブルスタイル */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #eee; padding: 12px; text-align: left; }
        th { background: #fafafa; }
        tr:hover { background: #fff9fc; }
        
        .btn { padding: 6px 12px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; }
        .btn-edit { background: #00bfff; color: white; }
        .btn-delete { background: #ff4d4d; color: white; margin-left: 5px; }
        .btn-save { background: #ff69b4; color: white; padding: 10px 20px; }
        .btn-export { background: #333; color: white; padding: 10px 20px; float: right; }

        /* エクスポート用エリア */
        #json-output { width: 100%; height: 200px; margin-top: 20px; display: none; font-family: monospace; font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="container">
    <h1>カタログデータ管理（編集・削除）</h1>
    
    <button class="btn btn-export" onclick="exportJson()">最新JSONをコピー用に生成</button>
    <p style="font-size: 0.8rem; color: #666;">※編集後は上のボタンでJSONを生成し、catalog.jsonに貼り付けてください。</p>

    <div id="edit-area" class="edit-form">
        <h3>アイテム編集</h3>
        <input type="hidden" id="edit-index">
        番号: <input type="text" id="edit-num" style="width: 60px;">
        サークル: <input type="text" id="edit-circle">
        商品名: <input type="text" id="edit-item" style="width: 200px;">
        価格: <input type="number" id="edit-price" style="width: 80px;">
        種別: <input type="text" id="edit-type" style="width: 80px;">
        <button class="btn btn-save" onclick="updateItem()">反映</button>
        <button class="btn" onclick="closeEdit()">キャンセル</button>
    </div>

    <table id="data-table">
        <thead>
            <tr>
                <th>番号</th>
                <th>サークル</th>
                <th>商品名</th>
                <th>種別</th>
                <th>価格</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody id="table-body">
            </tbody>
    </table>

    <textarea id="json-output" readonly placeholder="ここに最新のJSONが出力されます"></textarea>
</div>

<script>
    let catalogData = [];

    // データ読み込み
    async function loadData() {
        const res = await fetch('catalog.json');
        catalogData = await res.json();
        renderTable();
    }

    // テーブル描画
    function renderTable() {
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = catalogData.map((d, index) => `
            <tr>
                <td>${d.num || ''}</td>
                <td>${d.circle || ''}</td>
                <td>${d.item || ''}</td>
                <td>${d.type || ''}</td>
                <td>¥${(d.price || 0).toLocaleString()}</td>
                <td>
                    <button class="btn btn-edit" onclick="openEdit(${index})">編集</button>
                    <button class="btn btn-delete" onclick="deleteItem(${index})">削除</button>
                </td>
            </tr>
        `).join('');
    }

    // 削除機能
    function deleteItem(index) {
        if(confirm(`${catalogData[index].item} を削除しますか？`)) {
            catalogData.splice(index, 1);
            renderTable();
        }
    }

    // 編集フォームを開く
    function openEdit(index) {
        const d = catalogData[index];
        document.getElementById('edit-index').value = index;
        document.getElementById('edit-num').value = d.num || '';
        document.getElementById('edit-circle').value = d.circle || '';
        document.getElementById('edit-item').value = d.item || '';
        document.getElementById('edit-price').value = d.price || 0;
        document.getElementById('edit-type').value = d.type || '';
        document.getElementById('edit-area').style.display = 'block';
        window.scrollTo(0, 0);
    }

    // 編集を反映
    function updateItem() {
        const index = document.getElementById('edit-index').value;
        catalogData[index] = {
            num: document.getElementById('edit-num').value,
            circle: document.getElementById('edit-circle').value,
            item: document.getElementById('edit-item').value,
            price: parseInt(document.getElementById('edit-price').value),
            type: document.getElementById('edit-type').value
        };
        closeEdit();
        renderTable();
    }

    function closeEdit() {
        document.getElementById('edit-area').style.display = 'none';
    }

    // 最新のJSONをテキストエリアに出力
    function exportJson() {
        const output = document.getElementById('json-output');
        const jsonStr = JSON.stringify(catalogData, null, 2);
        output.value = jsonStr;
        output.style.display = 'block';
        
        // クリップボードにコピー
        output.select();
        document.execCommand('copy');
        alert("最新のJSONデータをクリップボードにコピーしました！\nGitHubの catalog.json に貼り付けて保存してください。");
    }

    loadData();
</script>

</body>
</html>
